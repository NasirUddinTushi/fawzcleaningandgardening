<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice {{ invoice.invoice_id }}</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 12px; margin: 40px; color: #333; }
    .header { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .company-info { width: 55%; }
    .bill-to { width: 40%; text-align: right; }

    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
    th { background: #f9f9f9; }
    .totals { margin-top: 20px; width: 100%; }
    .totals td { border: none; padding: 6px; }
    .totals .label { text-align: right; font-weight: bold; }
    .totals .amount { text-align: right; width: 120px; }
    .notes, .terms { margin-top: 20px; font-size: 11px; }
    .footer { margin-top: 40px; text-align: center; font-size: 10px; color: #888; }

    .bill-to-box {
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
      display: inline-block;
      text-align: left;
    }
  </style>
</head>
<body>
<h1 style="text-align:center; color: #c1c1c1;">INVOICE</h1>

<div class="company-logo" style="width: 100px; height: 100px; overflow: hidden; object-fit: cover;">
  <img src="file://{{ invoice.quote.company.logo.path }}" style="width: 100%; height: 100%;">
</div>

<div class="header">
  <div class="company-info">
    <p><strong>Quote ID #{{ invoice.quote.quote_id }}</strong></p>
    <h4>{{ invoice.quote.company.name }}</h4>
    <p>ABN: {{ invoice.quote.company.abn }}</p>
    <p>Address: {{ invoice.quote.company.address }}</p>
    <p>Mobile: <a href="tel:{{ invoice.quote.company.phone }}" target="_blank">{{ invoice.quote.company.phone }}</a></p>
    <p>Email: <a href="mailto:{{ invoice.quote.company.email }}" target="_blank">{{ invoice.quote.company.email }}</a></p>
    <p>Website: <a href="{{ invoice.quote.company.website }}" target="_blank">{{ invoice.quote.company.website }}</a></p>
  </div>

  <!-- âœ… Dynamic Bill To Section -->
  <div class="bill-to">
    <h3>Bill To:</h3>
    <div class="bill-to-box">
      <p><strong>{{ invoice.quote.quote_request.name }}</strong></p>
      <p>{{ invoice.quote.quote_request.email }}</p>
      {% if invoice.quote.quote_request.phone %}
      <p>Phone: {{ invoice.quote.quote_request.phone }}</p>
      {% endif %}
      <p>{{ invoice.quote.quote_request.address }}</p>
      <p>{{ invoice.quote.quote_request.city }} {{ invoice.quote.quote_request.postal_code }}</p>
    </div>
  </div>
</div>

<div style="display:flex; justify-content:space-between; width:100%;">
  <div class="left" style="display: flex; flex-direction: column;">
    <b>Date:</b>
    <b>Payment Terms:</b>
    <b>Due Date:</b>
    <b>Balance Due:</b>
  </div>
  <div class="right" style="display:flex; flex-direction:column;">
    <b>{{ invoice.created_at|date:"M d, Y" }}</b>
    <b>{{ invoice.payment_term }}</b>
    <b>{{ invoice.due_date|date:"M d, Y" }}</b>
    <b>${{ invoice.due|floatformat:2 }}</b>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th style="width: 55%;">Item</th>
      <th style="width: 15%;">Quantity</th>
      <th style="width: 15%;">Rate</th>
      <th style="width: 15%;">Amount</th>
    </tr>
  </thead>
  <tbody>
    {% for item in invoice.quote.items.all %}
    <tr>
      <td>{{ item.service.name }}</td>
      <td>{{ item.quantity }}</td>
      <td>${{ item.rate }}</td>
      <td>${{ item.amount }}</td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <th colspan="3" class="label" style="text-align: right;">Subtotal:</th>
      <td class="amount">${{ invoice.total|floatformat:2 }}</td>
    </tr>
    <tr>
      <th colspan="3" class="label" style="text-align: right;">Includes GST 10%:</th>
      <td class="amount">${{ invoice.gst_amount|floatformat:2 }}</td>
    </tr>
    <tr>
      <th colspan="3" class="label" style="text-align: right;">Total Amount ($):</th>
      <td class="amount">${{ invoice.total_with_gst|floatformat:2 }}</td>
    </tr>
  </tfoot>
</table>

<div class="notes">
  <strong>Notes:</strong>
  <p>1. Payment can be made via Bank Transfer.</p>
  <p>
    2. Payment Instruction:<br>
    Account Name: {{ invoice.quote.company.account_name|default:invoice.quote.company.name }}<br>
    BSB: {{ invoice.quote.company.bsb|default:"N/A" }}<br>
    Account Number: {{ invoice.quote.company.account_number|default:"N/A" }}
  </p>
</div>

<div class="terms">
  <strong>Terms:</strong>
  <p>
    1. Late payment fees may apply after the due date.<br>
    2. Additional charges may apply for special requests.
  </p>
</div>

<div class="footer">
  Thank you.
</div>

</body>
</html>
